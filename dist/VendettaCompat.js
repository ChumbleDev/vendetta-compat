const{native}=window.enmity;function reload(){native.reload()}function set(e,o,t){window.enmity.settings.set(e,o,t)}function get(e,o,t){return window.enmity.settings.get(e,o,t)}function registerPlugin(e){window.enmity.plugins.registerPlugin(e)}const Constants=window.enmity.modules.common.Constants,React=window.enmity.modules.common.React,Toasts=window.enmity.modules.common.Toasts,Dialog=window.enmity.modules.common.Dialog,StyleSheet=window.enmity.modules.common.StyleSheet;var name="VendettaCompat",version="2.0.0",description="Multi-layer Discord compatibility plugin supporting Bunny, Vendetta, and Revenge with performance optimizations",authors=[{name:"Rosie<3",id:"581573474296791211"},{name:"SerStars",id:"861631850681729045"}],color="#8B5CF6",Manifest={name,version,description,authors,color};const{components}=window.enmity,FormDivider=components.FormDivider,FormInput=components.FormInput,FormRow=components.FormRow,FormSection=components.FormSection,FormSwitch=components.FormSwitch,FormText=components.FormText;function getIDByName(e){return window.enmity.assets.getIDByName(e)}const LAYER_INFO={bunny:{name:"Bunny",description:"A Discord mobile modification focused on plugins and themes",defaultURL:"http://localhost:4040/bunny.js",icon:"ic_rabbit_24px",color:"#FF6B6B"},vendetta:{name:"Vendetta",description:"A Discord mobile client modification with powerful features",defaultURL:"http://localhost:4040/vendetta.js",icon:"ic_code_24px",color:"#8B5CF6"},revenge:{name:"Revenge",description:"A feature-rich Discord mobile modification",defaultURL:"http://localhost:4040/revenge.js",icon:"ic_sword_24px",color:"#EF4444"}};var Settings=({Manifest:e})=>{const[o,t]=React.useState(get(e.name,"bunnyConfig",{enabled:!0,useCustomURL:!1,customURL:LAYER_INFO.bunny.defaultURL})),[n,s]=React.useState(get(e.name,"vendettaConfig",{enabled:!1,useCustomURL:!1,customURL:LAYER_INFO.vendetta.defaultURL})),[r,a]=React.useState(get(e.name,"revengeConfig",{enabled:!1,useCustomURL:!1,customURL:LAYER_INFO.revenge.defaultURL})),l={bunny:o,vendetta:n,revenge:r},c={bunny:t,vendetta:s,revenge:a},u=StyleSheet.createThemedStyleSheet({icon:{color:Constants.ThemeColorMap.INTERACTIVE_NORMAL},enabledIcon:{color:Constants.ThemeColorMap.TEXT_POSITIVE},disabledIcon:{color:Constants.ThemeColorMap.TEXT_MUTED},sectionTitle:{color:StyleSheet.ThemeColorMap.HEADER_PRIMARY,fontFamily:Constants.Fonts.DISPLAY_BOLD,fontSize:16,marginBottom:4},info:{color:StyleSheet.ThemeColorMap.HEADER_SECONDARY,fontFamily:Constants.Fonts.PRIMARY_NORMAL,fontSize:12,marginTop:4,marginBottom:8},versionText:{color:StyleSheet.ThemeColorMap.TEXT_MUTED,fontFamily:Constants.Fonts.PRIMARY_NORMAL,fontSize:11,fontStyle:"italic"},layerSection:{marginVertical:8}}),d=(i,m)=>{c[i](f=>{const p={...f,...m};return set(e.name,`${i}Config`,p),p})},g=i=>{const m=l[i],f=LAYER_INFO[i],p=get(e.name,`${i}Version`,"unknown"),h=get(e.name,`${i}Timestamp`,0),y=h?new Date(h).toLocaleString():"Never";return React.createElement(FormSection,{key:i,title:f.name,style:u.layerSection},React.createElement(FormText,{style:u.info},f.description),React.createElement(FormRow,{label:`Enable ${f.name}`,subLabel:m.enabled?"Currently active":"Currently inactive",leading:React.createElement(FormRow.Icon,{style:m.enabled?u.enabledIcon:u.disabledIcon,source:getIDByName(m.enabled?"ic_check_circle_24px":"ic_circle_outline_24px")}),trailing:React.createElement(FormSwitch,{value:m.enabled,onValueChange:w=>d(i,{enabled:w})})}),m.enabled&&React.createElement(React.Fragment,null,React.createElement(FormRow,{label:"Use Custom URL",subLabel:"Load from a custom server instead of official builds",leading:React.createElement(FormRow.Icon,{style:u.icon,source:getIDByName("ic_link_24px")}),trailing:React.createElement(FormSwitch,{value:m.useCustomURL,onValueChange:w=>d(i,{useCustomURL:w})})}),m.useCustomURL&&React.createElement(FormInput,{value:m.customURL||f.defaultURL,onChangeText:w=>d(i,{customURL:w}),placeholder:f.defaultURL,title:`${f.name} Custom URL`}),React.createElement(FormRow,{label:"Version Information",subLabel:`Version: ${p} | Last loaded: ${y}`,leading:React.createElement(FormRow.Icon,{style:u.icon,source:getIDByName("ic_info_24px")})}),React.createElement(FormRow,{label:`Clear ${f.name} Cache`,subLabel:"Clear cached code and force fresh download",leading:React.createElement(FormRow.Icon,{style:u.icon,source:getIDByName("ic_trash_24px")}),trailing:()=>React.createElement(FormRow.Arrow,null),onPress:()=>{set(e.name,`${i}Code`,null),set(e.name,`${i}Timestamp`,0),set(e.name,`${i}Version`,"unknown"),Toasts.open({content:`Cleared ${f.name} cache successfully.`,source:getIDByName("ic_check_18px")})}})))};return React.createElement(React.Fragment,null,React.createElement(FormSection,{title:"Discord Compatibility Layers"},React.createElement(FormText,{style:u.info},"Enable and configure different Discord modification compatibility layers. Each layer provides access to their respective plugins, themes, and features.")),React.createElement(FormDivider,null),["bunny","vendetta","revenge"].map(i=>React.createElement(React.Fragment,{key:i},g(i),React.createElement(FormDivider,null))),React.createElement(FormSection,{title:"Global Settings"},React.createElement(FormRow,{label:"Clear All Data",subLabel:"Clear all cached code, settings, and dialogs for all layers",leading:React.createElement(FormRow.Icon,{style:u.icon,source:getIDByName("ic_message_delete")}),trailing:()=>React.createElement(FormRow.Arrow,null),onPress:()=>{["bunny","vendetta","revenge"].forEach(i=>{set(e.name,`${i}Code`,null),set(e.name,`${i}Timestamp`,0),set(e.name,`${i}Version`,"unknown")}),set(e.name,"shownEnabledDialog",!1),Toasts.open({content:"Successfully cleared all stored data for all compatibility layers.",source:getIDByName("ic_check_18px")})}}),React.createElement(FormRow,{label:"Force Reload All",subLabel:"Reload Discord to apply changes and refresh all compatibility layers",leading:React.createElement(FormRow.Icon,{style:u.icon,source:getIDByName("ic_message_retry")}),trailing:()=>React.createElement(FormRow.Arrow,null),onPress:()=>reload()})),React.createElement(FormDivider,null),React.createElement(FormSection,{title:"About"},React.createElement(FormText,{style:u.info},"Version ",e.version," by ",e.authors.map(i=>i.name).join(", ")),React.createElement(FormText,{style:u.versionText},"Enhanced with multi-layer support and performance optimizations")))};const DEFAULT_URLS={bunny:"https://raw.githubusercontent.com/bunny-mod/builds/main/bunny.js",vendetta:"https://github.com/vendetta-mod/builds/releases/latest/download/vendetta.js",revenge:"https://github.com/revenge-mod/revenge-builds/releases/latest/download/revenge.js"},VendettaCompat={...Manifest,async onStart(){this.loadCompatibilityLayers()},async loadCompatibilityLayers(){const e=["bunny","vendetta","revenge"],o=[];for(const t of e){const n=get(Manifest.name,`${t}Config`,{enabled:t==="bunny",useCustomURL:!1,customURL:t==="bunny"?"http://localhost:4040/bunny.js":"",lastLoaded:0,version:"unknown"});n.enabled&&o.push(this.loadCompatLayer(t,n))}o.length>0&&(await Promise.allSettled(o),this.showSuccessDialog())},async loadCompatLayer(e,o){const t=`${e}Code`,n=`${e}Timestamp`,s=`${e}Version`;try{const r=o.useCustomURL&&o.customURL?o.customURL:DEFAULT_URLS[e],a=get(Manifest.name,n,0),l=get(Manifest.name,t,null),c=Date.now()-a,u=l&&c<36e5;let d;if(u)d=l,console.log(`[${Manifest.name}] Using cached ${e} code`);else{console.log(`[${Manifest.name}] Fetching fresh ${e} code from ${r}`);const g=new AbortController,i=setTimeout(()=>g.abort(),1e4);try{const m=await fetch(r,{signal:g.signal,cache:"no-cache"});if(clearTimeout(i),m.ok){d=await m.text(),set(Manifest.name,t,d),set(Manifest.name,n,Date.now());const f=d.match(/version["\s]*:[\s]*["']([^"']+)["']/i);f&&set(Manifest.name,s,f[1])}else throw new Error(`HTTP ${m.status}: ${m.statusText}`)}catch(m){if(clearTimeout(i),console.warn(`[${Manifest.name}] Failed to fetch ${e}, using cached version:`,m),!l)throw new Error(`No cached ${e} code available and fetch failed`);d=l}}await new Promise((g,i)=>{setTimeout(()=>{try{eval(d),console.log(`[${Manifest.name}] Successfully loaded ${e}`),g()}catch(m){console.error(`[${Manifest.name}] Failed to execute ${e} code:`,m),i(m)}},0)})}catch(r){throw console.error(`[${Manifest.name}] Failed to load ${e}:`,r),r}},showSuccessDialog(){if(!get(Manifest.name,"shownEnabledDialog",!1)){const e=[];get(Manifest.name,"bunnyConfig",{enabled:!0}).enabled&&e.push("Bunny"),get(Manifest.name,"vendettaConfig",{enabled:!1}).enabled&&e.push("Vendetta"),get(Manifest.name,"revengeConfig",{enabled:!1}).enabled&&e.push("Revenge"),Dialog.show({title:"Compatibility Layers Loaded",body:`Successfully enabled ${e.join(", ")}. To disable, adjust settings in the plugin configuration.`,confirmText:"Okay",onConfirm:()=>set(Manifest.name,"shownEnabledDialog",!0)})}},onStop(){const e=["bunny","vendetta","revenge"],o=[];for(const t of e)try{const n=window[t];n&&typeof n.unload=="function"&&(n.unload(),o.push(t),console.log(`[${Manifest.name}] Successfully unloaded ${t}`))}catch(n){console.error(`[${Manifest.name}] Error unloading ${t}:`,n)}o.length>0&&Dialog.show({title:"Reload Required",body:`Unloaded ${o.join(", ")}. To fully disable the compatibility layers, please reload Discord.`,confirmText:"Reload Now",cancelText:"Later",onConfirm:()=>reload()})},getSettingsPanel(){return React.createElement(Settings,{Manifest})}};registerPlugin(VendettaCompat);
